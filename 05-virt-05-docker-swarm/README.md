# Домашнее задание к занятию "5. Оркестрация кластером Docker контейнеров на примере Docker Swarm"

## Как сдавать задания

Обязательными к выполнению являются задачи без указания звездочки. Их выполнение необходимо для получения зачета и диплома о профессиональной переподготовке.

Задачи со звездочкой (*) являются дополнительными задачами и/или задачами повышенной сложности. Они не являются обязательными к выполнению, но помогут вам глубже понять тему.

Домашнее задание выполните в файле readme.md в github репозитории. В личном кабинете отправьте на проверку ссылку на .md-файл в вашем репозитории.

Любые вопросы по решению задач задавайте в чате учебной группы.

---


## Важно!

Перед отправкой работы на проверку удаляйте неиспользуемые ресурсы.
Это важно для того, чтоб предупредить неконтролируемый расход средств, полученных в результате использования промокода.

Подробные рекомендации [здесь](https://github.com/netology-code/virt-homeworks/blob/virt-11/r/README.md)

---

## Задача 1

Дайте письменые ответы на следующие вопросы:

- В чём отличие режимов работы сервисов в Docker Swarm кластере: replication и global?

Отличие режимов работы сервисов Docker Swarm кластере заключается, в том, что в режиме global сервис запускается на всех нодах. Если используется режим replication, то указывается количество реплик используемых для сервиса.

- Какой алгоритм выбора лидера используется в Docker Swarm кластере?

Используется так называемый алгоритм поддержания распределенного консенсуса — Raft.

- Что такое Overlay Network?

Overlay-сети используются в контексте кластеров (Docker Swarm), где виртуальная сеть, которую используют контейнеры, связывает несколько физических хостов, на которых запущен Docker.

Сети overlay: их создает сам пользователь и их можно прикрепить к контейнерам. Эти сети служат общей подсетью для контейнеров единой сети, в которой они могут обмениваться данными напрямую (даже если они запущены на разных физических хостах).

## Задача 2

Создать ваш первый Docker Swarm кластер в Яндекс.Облаке

Для получения зачета, вам необходимо предоставить скриншот из терминала (консоли), с выводом команды:
```
docker node ls
```
<img width="1655" alt="Screenshot 2022-12-13 at 23 47 39" src="https://user-images.githubusercontent.com/43722443/207451079-bf1aa9db-480a-4dd4-be3d-fe0a816f4838.png">

## Задача 3

Создать ваш первый, готовый к боевой эксплуатации кластер мониторинга, состоящий из стека микросервисов.

Для получения зачета, вам необходимо предоставить скриншот из терминала (консоли), с выводом команды:
```
docker service ls
```
<img width="1659" alt="Screenshot 2022-12-13 at 23 54 48" src="https://user-images.githubusercontent.com/43722443/207452655-45a740ae-d971-458f-9004-b2a3b1ea5d37.png">

## Задача 4 (*)

Выполнить на лидере Docker Swarm кластера команду (указанную ниже) и дать письменное описание её функционала, что она делает и зачем она нужна:
```
# см.документацию: https://docs.docker.com/engine/swarm/swarm_manager_locking/
docker swarm update --autolock=true
```
[centos@node01 ~]$ sudo docker swarm update --autolock=true
Swarm updated.
To unlock a swarm manager after it restarts, run the `docker swarm unlock`
command and provide the following key:

    SWMKEY-1-5XRDbItYC0cc6x+G3IIf2rytmwQAvdXsmUAap3NtgAc

Please remember to store this key in a password manager, since without it you
will not be able to restart the manager.

Блокируйте рой для защиты ключа шифрования.
Журналы Raft, используемые менеджерами роя, по умолчанию зашифрованы на диске. Это шифрование в состоянии покоя защищает конфигурацию и данные вашего сервиса от злоумышленников, которые получают доступ к зашифрованным журналам Raft. Одна из причин, по которой эта функция была введена, заключалась в поддержке функции секретов Docker .

При перезапуске Docker в память каждого управляющего узла загружается как ключ TLS, используемый для шифрования связи между узлами swarm, так и ключ, используемый для шифрования и расшифровки журналов Raft на диске. Docker может защитить общий ключ шифрования TLS и ключ, используемый для шифрования и расшифровки журналов Raft в состоянии покоя, позволяя вам стать владельцем этих ключей и требовать ручной разблокировки ваших менеджеров. Эта функция называется автоблокировкой .

Когда Docker перезапустится, вы должны сначала разблокировать рой , используя ключ шифрования , сгенерированный Docker, когда рой был заблокирован. Вы можете изменить этот ключ шифрования в любое время.

Включить или выключить автоблокировку на существующем рое.
Чтобы включить автоблокировку на существующем рое, установите для флага autolock значение true.
Чтобы отключить автоблокировку, установите для --autolock значение false .

Взаимный ключ TLS и ключ шифрования, используемые для чтения и записи журналов Raft, хранятся в незашифрованном виде на диске. Существует компромисс между риском сохранения незашифрованного ключа шифрования в покое и удобством перезапуска роя без необходимости разблокировки каждого менеджера.

Чтобы разблокировать заблокированный рой, используйте docker swarm unlock.
